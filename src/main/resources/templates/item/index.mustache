<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>2인 과제 페이지</h1>
    <form id="form" action="javascript:input()" method="post">
        <table>
            <tr>
                <th>이름</th>
                <td><input name="name" id="name" /></td>
            </tr>

            <tr>
                <th>수량</th>
                <td><input name="count" id="count" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" /></td>
            </tr>

            <tr>
                <th>가격</th>
                <td><input name="price" id="price" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" /></td>
            </tr>
        </table>
        <button type="submit">등록</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>번호</th>
                <th>이름</th>
                <th>수량</th>
                <th>가격</th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>

        <tbody>
        {{#item}}
            <tr>
                <td>{{no}}</td>
                <td>{{name}}</td>
                <td>{{count}}</td>
                <td>{{price}}</td>
                <td><input name="input" id="input{{no}}" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" /></td>
                <td>
                    <button type="button" onclick="countUpdate({{no}});">수량 수정</button>
                    <button type="button" onclick="priceUpdate({{no}});">가격 수정</button>
                </td>
                <td><button type="button" onclick="itemDelete({{no}});">삭제</button></td>
            </tr>
        {{/item}}
        </tbody>
    </table>

    <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script>
        function input(){
            let name=document.querySelector('#name').value;     console.log(name);
            let count=document.querySelector('#count').value;     console.log(count);
            let price=document.querySelector('#price').value;     console.log(price);

            let info={name:name, count:count, price:price};
            console.log(info);

            $.ajax({
                url : '/item/input',
                method : 'POST',
                data : info,
                success : function (result){
                    console.log(result);
                    if(result){
                        alert('등록 성공');
                        location.reload();
                    }
                    else{
                        alert('등록 실패');
                    }
                }
            })
        };

        function itemDelete(e){
            let info={no:e};
            console.log(info);

            $.ajax({
                url : '/item/delete',
                method : 'POST',
                data : info,
                success : function (result){
                    console.log(result);
                    if(result){
                        alert('삭제 성공');
                        location.reload();
                    }
                    else{
                        alert('삭제 실패');
                    }
                }
            })

        }

        function countUpdate(no){
        let input=document.querySelector('#input'+no).value;

        let info={no:no, count:input};
            console.log(info);

            $.ajax({
                url : '/item/itemUpdate',
                method : 'POST',
                data : info,
                success : function (result){
                    console.log(result);
                    if(result){
                        alert('개수 수정 성공');
                        location.reload();
                    }
                    else{
                        alert('개수 수정 실패');
                    }
                }
            })
        }

        function priceUpdate(no){
        let input=document.querySelector('#input'+no).value;

        let info={no:no, price:input,count:-1};
            console.log(info);

            $.ajax({
                url : '/item/itemUpdate',
                method : 'POST',
                data : info,
                success : function (result){
                    console.log(result);
                    if(result){
                        alert('가격 수정 성공');
                        location.reload();
                    }
                    else{
                        alert('가격 수정 실패');
                    }
                }
            })
        }
    </script>
</body>
</html>